{% extends 'base.html' %}

{% block title %}发布讨论 - 电影评分系统{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-plus-circle me-2"></i>
                        发布新讨论
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="mb-3">
                            <label for="category" class="form-label">讨论分类</label>
                            <select class="form-select" id="category" name="category" required>
                                <option value="电影讨论">电影讨论</option>
                                <option value="影评分享">影评分享</option>
                                <option value="推荐求助">推荐求助</option>
                                <option value="行业资讯">行业资讯</option>
                                <option value="技术交流">技术交流</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">讨论标题</label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   placeholder="请输入一个吸引人的标题..." required maxlength="100">
                            <div class="form-text">标题最多100字</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="content" class="form-label">讨论内容</label>
                            <textarea class="form-control" id="content" name="content" rows="8" 
                                      placeholder="详细描述您想讨论的内容..." required></textarea>
                            <div class="form-text">
                                支持换行，请详细描述您的观点或问题
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>发布须知：</strong>
                            <ul class="mb-0 mt-2">
                                <li>请保持友善和尊重的讨论氛围</li>
                                <li>避免发布与电影无关的内容</li>
                                <li>不要发布违法违规信息</li>
                                <li>鼓励建设性的讨论和交流</li>
                            </ul>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('community') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>返回讨论区
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-2"></i>发布讨论
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 热门讨论预览 -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-fire text-danger me-2"></i>
                        热门讨论
                    </h6>
                </div>
                <div class="card-body">
                    <div class="small text-muted">
                        <p><i class="fas fa-lightbulb text-warning me-1"></i> 提示：好的讨论标题能够吸引更多用户参与</p>
                        <p><i class="fas fa-heart text-danger me-1"></i> 建议：详细描述问题背景，让其他用户更容易理解和回复</p>
                        <p><i class="fas fa-users text-info me-1"></i> 鼓励：分享您的观影感受和独特见解</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* 强制新讨论表单输入框可用 */
.card-body input.form-control,
.card-body input[type="text"],
.card-body textarea.form-control,
.card-body select.form-select {
    background: rgba(255, 255, 255, 0.95) !important;
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    color: #2c3e50 !important;
    border-radius: 12px !important;
    padding: 12px 16px !important;
    font-size: 16px !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    width: 100% !important;
    height: auto !important;
    line-height: 1.5 !important;
    font-family: inherit !important;
    /* 确保完全可交互 */
    pointer-events: auto !important;
    user-select: text !important;
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
    position: relative !important;
    z-index: 1000 !important;
    overflow: visible !important;
    outline: none !important;
    /* 清除所有可能的干扰 */
    transform: none !important;
    clip: none !important;
    clip-path: none !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

.card-body input.form-control:focus,
.card-body input[type="text"]:focus,
.card-body textarea.form-control:focus,
.card-body select.form-select:focus {
    background: rgba(255, 255, 255, 1) !important;
    border-color: #3498db !important;
    box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25), 0 4px 15px rgba(0, 0, 0, 0.1) !important;
    color: #2c3e50 !important;
    outline: none !important;
    transform: none !important;
    z-index: 1001 !important;
}

.card-body input.form-control::placeholder,
.card-body input[type="text"]::placeholder,
.card-body textarea.form-control::placeholder {
    color: #7f8c8d !important;
    opacity: 0.8 !important;
    font-style: italic !important;
}

.card-body .form-label {
    color: #ecf0f1 !important;
    font-weight: 600 !important;
    margin-bottom: 8px !important;
    font-size: 16px !important;
    display: block !important;
}

.card-body .form-text {
    color: #bdc3c7 !important;
    font-size: 13px !important;
    margin-top: 5px !important;
    opacity: 0.8 !important;
}

/* 确保表单容器可交互 */
.card-body,
.card-body form,
.card-body form *,
.mb-3 {
    overflow: visible !important;
    pointer-events: auto !important;
}
</style>

<script>
// 新讨论页面输入框修复脚本
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== 新讨论页面调试信息 ===');
    
    // 获取所有输入框
    const inputs = document.querySelectorAll('.card-body input, .card-body textarea, .card-body select');
    console.log('发现输入元素数量:', inputs.length);
    
    inputs.forEach((input, index) => {
        console.log(`输入元素 ${index + 1}:`, {
            tagName: input.tagName,
            id: input.id,
            name: input.name,
            type: input.type,
            placeholder: input.placeholder
        });
        
        // 强制设置输入框属性
        input.style.pointerEvents = 'auto';
        input.style.userSelect = 'text';
        input.style.position = 'relative';
        input.style.zIndex = '1000';
        input.style.overflow = 'visible';
        input.style.background = 'rgba(255, 255, 255, 0.95)';
        input.style.color = '#2c3e50';
        input.style.border = '2px solid rgba(255, 255, 255, 0.3)';
        input.style.borderRadius = '12px';
        input.style.padding = '12px 16px';
        input.style.fontSize = '16px';
        input.style.width = '100%';
        input.style.display = 'block';
        input.style.opacity = '1';
        input.style.visibility = 'visible';
        input.style.transform = 'none';
        input.style.clip = 'none';
        input.style.clipPath = 'none';
        
        // 移除可能的干扰属性
        input.removeAttribute('readonly');
        input.removeAttribute('disabled');
        
        // 添加事件监听器
        input.addEventListener('focus', function() {
            console.log('新讨论输入元素获得焦点:', this.name || this.id || this.tagName);
            this.style.background = 'rgba(255, 255, 255, 1)';
            this.style.borderColor = '#3498db';
            this.style.zIndex = '1001';
        });
        
        input.addEventListener('blur', function() {
            console.log('新讨论输入元素失去焦点:', this.name || this.id || this.tagName);
            this.style.background = 'rgba(255, 255, 255, 0.95)';
            this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            this.style.zIndex = '1000';
        });
        
        input.addEventListener('input', function() {
            console.log('新讨论输入内容:', this.name || this.id || this.tagName, '=', this.value);
        });
        
        input.addEventListener('change', function() {
            console.log('新讨论元素值改变:', this.name || this.id || this.tagName, '=', this.value);
        });
        
        // 测试元素是否可以获得焦点
        setTimeout(() => {
            try {
                input.focus();
                console.log(`新讨论输入元素 ${input.name || input.id || input.tagName} 可以获得焦点`);
                setTimeout(() => input.blur(), 100);
            } catch (e) {
                console.error(`新讨论输入元素 ${input.name || input.id || input.tagName} 无法获得焦点:`, e);
            }
        }, 100 * (index + 1));
    });
    
    console.log('=== 新讨论页面调试信息结束 ===');
});

// 表单验证
document.querySelector('form').addEventListener('submit', function(e) {
    const title = document.getElementById('title').value.trim();
    const content = document.getElementById('content').value.trim();
    
    if (title.length < 5) {
        alert('标题至少需要5个字符');
        e.preventDefault();
        return;
    }
    
    if (content.length < 10) {
        alert('内容至少需要10个字符');
        e.preventDefault();
        return;
    }
    
    console.log('表单验证通过，提交讨论');
});
</script>
{% endblock %} 